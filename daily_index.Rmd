---
title: Daglig endring i trafikk i de største byområdene
output: 
  word_document:
    reference_docx: svv_notatmal3.docx
    toc: true
    toc_depth: 2
    fig_caption: true
    fig_width: 7
---

```{r setup, include = FALSE, echo = FALSE, warning=FALSE, message=FALSE}
# Packages are loaded through sourcing rmd_setup.R
source("rmd_setup.R")

# Traffic Data API calls to get points metadata and aadt
source("get_from_trafficdata_api.R")

# Points used in each city
cities_points_start <- read.csv2("data_points_raw/cities_points.csv") %>% 
  dplyr::filter(city_area_name %in% c("Bergen",
                                      "Nord-Jæren",
                                      "Oslo og Akershus",
                                      "Trondheim",
                                      "Tromsø"),
                !is.na(trp_id)) %>% 
  dplyr::distinct(trp_id, .keep_all = TRUE) %>% 
  dplyr::select(city_area_name, trp_id) %>% 
  # Remove unusable trps
  dplyr::filter(!(trp_id %in% c("65625V41945",
                                "21801V72158",
                                "81008V41567",
                                "14772V41375",
                                "20570V72811",
                                "17949V320695",
                                "75341V41863")))

additional_trps <- 
  data.frame(city_area_name = 
               c(rep("Trondheim", times = 9),
                 rep("Nord-Jæren", times = 29),
                 rep("Bodø", times = 11)),
             trp_id = c(
                                  # Trondheim
                                  "04211V1677432",
                                  "78492V2394249",
                                  "44660V72811",
                                  "75341V41863",
                                  "17961V72812",
                                  "36935V72359",
                                  "01676V41944",
                                  "60797V2801059",
                                  "66126V3112188",
                                  # Nord-Jæren
                                  #"93189V320582",
                                  "52780V320689",
                                  "13715V2721330",
                                  "14570V320273",
                                  #"50749V319525",
                                  "11531V320190",
                                  #"71535V319524",
                                  "50741V1727509",
                                  "41451V320581",
                                  "64211V2520554",
                                  "55507V319881",
                                  "33926V2721315",
                                  "12478V320582",
                                  "88125V320152",
                                  "33902V320184",
                                  "84064V320581",
                                  "08952V320223",
                                  "81631V1727485",
                                  "59675V319722",
                                  "58562V320296",
                                  "03819V320689",
                                  "45342V320223",
                                  "44083V319868",
                                  "35382V1727514",
                                  "24330V320678",
                                  "36178V320198",
                                  #"92102V319885",
                                  #"32842V319521",
                                  "61487V319872",
                                  "00462V320124",
                                  "48362V320684",
                                  "89794V320138",
                                  "05658V320707",
                                  "57836V319878",
                                  # Bodø
                                  "18346V886007",
                                  "43264V886007",
                                  "66316V2676855",
                                  "33696V2676853",
                                  "91229V886007",
                                  "26549V2669516",
                                  "29133V1201961",
                                  "90646V1201961",
                                  "74801V2676825",
                                  "77027V1207593",
                                  "86957V885288"
                                  ))

cities_points <- bind_rows(cities_points_start, additional_trps)

# All points from Traffic Data API
points <- get_points() %>%
  dplyr::select(trp_id, name, road_reference, municipality_name,
                lat, lon) %>%
  dplyr::distinct(trp_id, .keep_all = T)

# Adding metadata to trps
trps <- dplyr::left_join(cities_points, points) %>%
  dplyr::filter(!is.na(name)) %>% 
  dplyr::filter(!stringr::str_detect(road_reference, "KD"))

# Will make different comparisons with different bases:
# 1a. Week 10 2020, 
# 1b. for Bodø and Tromsø which use week 9 as they had vacation in week 10
# 2. Same week in 2019
# 3. Easter

# Week 11 onwards 2019, including Easter
week_2019_from <- "2019-03-11T00:00:00+01:00"
week_2019_to <- "2019-09-02T00:00:00+01:00"

week_2020_from <- "2020-02-24T00:00:00+01:00"
week_2020_to <- "2020-08-31T00:00:00+01:00"

ukedager <- c("Mandag",
              "Tirsdag",
              "Onsdag",
              "Torsdag",
              "Fredag",
              "Lørdag",
              "Søndag")

norske_ukedager <- data.frame(weekday = c(1, 2, 3, 4, 5, 6, 7),
                              ukedag = ordered(ukedager,
                                               levels = ukedager))

# Fetch daily traffic from API
dt_2019 <- get_dt_for_trp_list(trps$trp_id,
                        week_2019_from,
                        week_2019_to)


dt_2020 <- get_dt_for_trp_list(trps$trp_id,
                               week_2020_from,
                               week_2020_to)


dt <- bind_rows(dt_2019, dt_2020) %>%
  select(-point_name) %>%
  mutate(year = lubridate::year(from),
         weekno = lubridate::isoweek(from),
         weekday = lubridate::wday(from,
                                   week_start = 
                                     getOption("lubridate.week.start", 1))) %>%
  select(-from) %>% 
  filter(coverage > 99)


#  Base weeks ####
dt_2020_10 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 10) %>% 
  select(point_id, total_volume, weekno, weekday)

# For the north
dt_2020_09 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 9) %>% 
  select(point_id, total_volume, weekno, weekday)


# Weeks 2019 ####
dt_2019_11 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 11) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  # Excluding points with anomalous traffic
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007")))

dt_2019_12 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 12) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007")))

dt_2019_13 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 13) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007")))

dt_2019_14 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 14) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007")))

dt_2019_15_palmweekend <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 15,
         weekday > 4) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "75341V41863")))

dt_2019_16_easterweek <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 16) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "75341V41863")))

dt_2019_17_eastermonday <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 17,
         weekday < 2) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "75341V41863")))

dt_2019_17 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 17,
         weekday > 1) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "75341V41863")))

dt_2019_18 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 18) %>%
  # removing 1 May
  filter(weekday != 3) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_1_may <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 18) %>%
  filter(weekday == 3) %>% 
  select(point_id, total_volume, weekno) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240"))) %>% 
  mutate(weekday = "1. mai")

dt_2019_19 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 19) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_20 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 20) %>%
  # removing 17 May
  filter(weekday != 5) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240",
                           "67263V1811577")))

dt_2019_17_may <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 20) %>%
  filter(weekday == 5) %>% 
  select(point_id, total_volume, weekno) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))%>% 
  mutate(weekday = "17. mai")

# Special days
dt_2019_spring_specials <-
  dplyr::bind_rows(dt_2019_1_may,
                   dt_2019_17_may)

dt_2019_21 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 21) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_22_ascension <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 22) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_23_whitsun <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 23) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_24_whitmonday <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 24) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_25 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 25) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_26 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 26) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_27 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 27) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_28 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 28) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_29 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 29) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_30 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 30) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_31 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 31) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_32 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 32) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_33 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 33) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_34 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 34) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

dt_2019_35 <- dt %>% 
  filter(year == 2019) %>%
  filter(weekno == 35) %>%
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("21768V805002",
                           "41331V443662",
                           "71258V805748",
                           "87138V755378",
                           "91229V886007",
                           "42754V444240")))

# ADD NEW WEEK HERE!


# Weeks 2020 ####
dt_2020_11 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 11) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_12 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 12) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_13 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 13) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_14 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 14,
         weekday < 5) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_14_palmweekend <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 14,
         weekday > 4) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_15_easterweek <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 15) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_16_eastermonday <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 16,
         weekday < 2) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_16 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 16,
         weekday > 1) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("67263V1811577")))

dt_2020_17 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 17) %>% 
  select(point_id, total_volume, weekno, weekday)

dt_2020_18 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 18) %>%
  # removing 1 May
  filter(weekday != 5) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("42754V444240")))

dt_2020_1_may <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 18) %>%
  filter(weekday == 5) %>% 
  select(point_id, total_volume, weekno) %>% 
  filter(!(point_id %in% c("42754V444240"))) %>% 
  mutate(weekday = "1. mai")

dt_2020_19 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 19) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("42754V444240")))

dt_2020_20 <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 20) %>% 
  # removing 17 May
  filter(weekday != 7) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("42754V444240")))

dt_2020_17_may <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 20) %>% 
  filter(weekday == 7) %>% 
  select(point_id, total_volume, weekno) %>% 
  filter(!(point_id %in% c("42754V444240"))) %>% 
  mutate(weekday = "17. mai")

# Special days
dt_2020_spring_specials <-
  dplyr::bind_rows(dt_2020_1_may,
                   dt_2020_17_may)

dt_2020_21_ascension <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 21) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("42754V444240")))

dt_2020_22_whitsun <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 22) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("42754V444240")))

dt_2020_23_whitmonday <- dt %>% 
  filter(year == 2020) %>%
  filter(weekno == 23) %>% 
  select(point_id, total_volume, weekno, weekday) %>% 
  filter(!(point_id %in% c("42754V444240")))



# ADD NEW WEEK HERE!


# Trp index
calculate_trp_index <- function(dt_base, dt_calc) {
  trp_daily_index <- inner_join(dt_base, dt_calc,
                            by = c("point_id", "weekday"),
                            suffix = c("_b", "_c")) %>% 
  mutate(index = round((total_volume_c / total_volume_b - 1) * 100, digits = 1)) %>% 
  left_join(norske_ukedager) %>% 
  select(point_id, ukedag, index) %>% 
  left_join(points, by = c("point_id" = "trp_id")) %>% 
  left_join(cities_points, by = c("point_id" = "trp_id")) %>% 
  select(ukedag, name, road_reference, city_area_name, index)
}

calculate_trp_index_movable_days <- function(dt_base, dt_calc) {
  trp_daily_index <- inner_join(dt_base, dt_calc,
                            by = c("point_id", "weekday"),
                            suffix = c("_b", "_c")) %>% 
  mutate(index = round((total_volume_c / total_volume_b - 1) * 100, digits = 1)) %>% 
  #left_join(norske_ukedager) %>% 
  select(point_id, weekday, index) %>% 
  left_join(points, by = c("point_id" = "trp_id")) %>% 
  left_join(cities_points, by = c("point_id" = "trp_id")) %>% 
  select(weekday, name, road_reference, city_area_name, index)
}



# Compare dt to 2020 week 10  ####
trp_dt_2020_10_11 <- calculate_trp_index(dt_2020_10, dt_2020_11) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_12 <- calculate_trp_index(dt_2020_10, dt_2020_12) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_13 <- calculate_trp_index(dt_2020_10, dt_2020_13) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_14 <- calculate_trp_index(dt_2020_10, dt_2020_14) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_16 <- calculate_trp_index(dt_2020_10, dt_2020_16) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_17 <- calculate_trp_index(dt_2020_10, dt_2020_17) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_18 <- calculate_trp_index(dt_2020_10, dt_2020_18) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_19 <- calculate_trp_index(dt_2020_10, dt_2020_19) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

trp_dt_2020_10_20 <- calculate_trp_index(dt_2020_10, dt_2020_20) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

# Ending this series with week 20 here. Week 9/10 is no longer the norm.

# For the north
trp_dt_2020_09_11 <- calculate_trp_index(dt_2020_09, dt_2020_11) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_12 <- calculate_trp_index(dt_2020_09, dt_2020_12) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_13 <- calculate_trp_index(dt_2020_09, dt_2020_13) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_14 <- calculate_trp_index(dt_2020_09, dt_2020_14) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_16 <- calculate_trp_index(dt_2020_09, dt_2020_16) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_17 <- calculate_trp_index(dt_2020_09, dt_2020_17) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_18 <- calculate_trp_index(dt_2020_09, dt_2020_18) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_19 <- calculate_trp_index(dt_2020_09, dt_2020_19) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

trp_dt_2020_09_20 <- calculate_trp_index(dt_2020_09, dt_2020_20) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

# Ending this series with week 20 here. Week 9/10 is no longer the norm.


# Compare this week to same week 2019 ####
trp_dt_201911_202011 <- calculate_trp_index(dt_2019_11, dt_2020_11)
trp_dt_201912_202012 <- calculate_trp_index(dt_2019_12, dt_2020_12)
trp_dt_201913_202013 <- calculate_trp_index(dt_2019_13, dt_2020_13)
trp_dt_201914_202014 <- calculate_trp_index(dt_2019_14, dt_2020_14)
trp_dt_201917_202017 <- calculate_trp_index(dt_2019_17, dt_2020_17)
trp_dt_201918_202018 <- calculate_trp_index(dt_2019_18, dt_2020_18)
trp_dt_201919_202019 <- calculate_trp_index(dt_2019_19, dt_2020_19)
trp_dt_201920_202020 <- calculate_trp_index(dt_2019_20, dt_2020_20)
trp_dt_2019_2020_ascension <- calculate_trp_index(
  dt_2019_22_ascension, dt_2020_21_ascension)
trp_dt_2019_2020_whitsun <- calculate_trp_index(
  dt_2019_23_whitsun, dt_2020_22_whitsun)
trp_dt_2019_2020_whitmonday <- calculate_trp_index(
  dt_2019_24_whitmonday, dt_2020_23_whitmonday)
trp_dt_201924_202021 <- calculate_trp_index(dt_2019_21, dt_2020_24)
trp_dt_201925_202025 <- calculate_trp_index(dt_2019_25, dt_2020_25)
trp_dt_201926_202026 <- calculate_trp_index(dt_2019_26, dt_2020_26)
trp_dt_201927_202027 <- calculate_trp_index(dt_2019_27, dt_2020_27)
trp_dt_201928_202028 <- calculate_trp_index(dt_2019_28, dt_2020_28)
trp_dt_201929_202029 <- calculate_trp_index(dt_2019_29, dt_2020_29)
trp_dt_201930_202030 <- calculate_trp_index(dt_2019_30, dt_2020_30)
trp_dt_201931_202031 <- calculate_trp_index(dt_2019_31, dt_2020_31)
trp_dt_201932_202032 <- calculate_trp_index(dt_2019_32, dt_2020_32)
trp_dt_201933_202033 <- calculate_trp_index(dt_2019_33, dt_2020_33)
trp_dt_201934_202034 <- calculate_trp_index(dt_2019_34, dt_2020_34)
trp_dt_201935_202035 <- calculate_trp_index(dt_2019_35, dt_2020_35)


# Spring specials
trp_dt_spring <- calculate_trp_index_movable_days(dt_2019_spring_specials,
                                                  dt_2020_spring_specials)

# Easter
trp_dt_palmweekend <- calculate_trp_index(dt_2019_15_palmweekend, 
                                          dt_2020_14_palmweekend)

trp_dt_easterweek <- calculate_trp_index(dt_2019_16_easterweek,
                                         dt_2020_15_easterweek)

trp_dt_eastermonday <- calculate_trp_index(dt_2019_17_eastermonday,
                                           dt_2020_16_eastermonday)


# City index ####
calculate_city_index <- function(dt_base, dt_calc) {
  city_daily_index <- inner_join(dt_base, dt_calc,
                            by = c("point_id", "weekday"),
                            suffix = c("_b", "_c")) %>% 
  left_join(cities_points, by = c("point_id" = "trp_id")) %>% 
  group_by(weekday, city_area_name) %>% 
  summarise(city_volume_b = sum(total_volume_b),
            city_volume_c = sum(total_volume_c),
            no_trp = n()
            ) %>% 
  mutate(index = round((city_volume_c / city_volume_b - 1) * 100, 
                       digits = 1)) %>% 
  left_join(norske_ukedager) %>% 
  select(city_area_name, ukedag, no_trp, index)
}

calculate_city_index_movable_days <- function(dt_base, dt_calc) {
  city_daily_index <- inner_join(dt_base, dt_calc,
                            by = c("point_id", "weekday"),
                            suffix = c("_b", "_c")) %>% 
  left_join(cities_points, by = c("point_id" = "trp_id")) %>% 
  group_by(weekday, city_area_name) %>% 
  summarise(city_volume_b = sum(total_volume_b),
            city_volume_c = sum(total_volume_c),
            no_trp = n()
            ) %>% 
  mutate(index = round((city_volume_c / city_volume_b - 1) * 100, 
                       digits = 1)) %>% 
  #left_join(norske_ukedager) %>% 
  select(city_area_name, weekday, no_trp, index)
}


# Compare this week to 2020 week 10
city_dt_2020_10_11 <- calculate_city_index(dt_2020_10, dt_2020_11) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_12 <- calculate_city_index(dt_2020_10, dt_2020_12) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_13 <- calculate_city_index(dt_2020_10, dt_2020_13) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_14 <- calculate_city_index(dt_2020_10, dt_2020_14) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_16 <- calculate_city_index(dt_2020_10, dt_2020_16) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_17 <- calculate_city_index(dt_2020_10, dt_2020_17) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_18 <- calculate_city_index(dt_2020_10, dt_2020_18) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_19 <- calculate_city_index(dt_2020_10, dt_2020_19) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

city_dt_2020_10_20 <- calculate_city_index(dt_2020_10, dt_2020_20) %>% 
  filter(!(city_area_name %in% c("Bodø", "Tromsø")))

# Ending this series with week 20 here. Week 9/10 is no longer the norm.

# For the north
city_dt_2020_09_11 <- calculate_city_index(dt_2020_09, dt_2020_11) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_12 <- calculate_city_index(dt_2020_09, dt_2020_12) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_13 <- calculate_city_index(dt_2020_09, dt_2020_13) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_14 <- calculate_city_index(dt_2020_09, dt_2020_14) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_16 <- calculate_city_index(dt_2020_09, dt_2020_16) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_17 <- calculate_city_index(dt_2020_09, dt_2020_17) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_18 <- calculate_city_index(dt_2020_09, dt_2020_18) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_19 <- calculate_city_index(dt_2020_09, dt_2020_19) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

city_dt_2020_09_20 <- calculate_city_index(dt_2020_09, dt_2020_20) %>% 
  filter(city_area_name %in% c("Bodø", "Tromsø"))

# Ending this series with week 20 here. Week 9/10 is no longer the norm.


# Compare this week to same week 2019
city_dt_201911_202011 <- calculate_city_index(dt_2019_11, dt_2020_11) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201912_202012 <- calculate_city_index(dt_2019_12, dt_2020_12) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201913_202013 <- calculate_city_index(dt_2019_13, dt_2020_13) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201914_202014 <- calculate_city_index(dt_2019_14, dt_2020_14) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201917_202017 <- calculate_city_index(dt_2019_17, dt_2020_17) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201918_202018 <- calculate_city_index(dt_2019_18, dt_2020_18) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201919_202019 <- calculate_city_index(dt_2019_19, dt_2020_19) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201920_202020 <- calculate_city_index(dt_2019_20, dt_2020_20) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_2019_2020_ascension <- calculate_city_index(dt_2019_22_ascension, 
                                                    dt_2020_21_ascension) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_2019_2020_whitsun <- calculate_city_index(dt_2019_23_whitsun, 
                                                    dt_2020_22_whitsun) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_2019_2020_whitmonday <- calculate_city_index(dt_2019_24_whitmonday, 
                                                     dt_2020_23_whitmonday) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201921_202024 <- calculate_city_index(dt_2019_21, dt_2020_24) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201925_202025 <- calculate_city_index(dt_2019_25, dt_2020_25) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201926_202026 <- calculate_city_index(dt_2019_26, dt_2020_26) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201927_202027 <- calculate_city_index(dt_2019_27, dt_2020_27) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201928_202028 <- calculate_city_index(dt_2019_28, dt_2020_28) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201929_202029 <- calculate_city_index(dt_2019_29, dt_2020_29) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201930_202030 <- calculate_city_index(dt_2019_30, dt_2020_30) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201931_202031 <- calculate_city_index(dt_2019_31, dt_2020_31) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201932_202032 <- calculate_city_index(dt_2019_32, dt_2020_32) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201933_202033 <- calculate_city_index(dt_2019_33, dt_2020_33) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201934_202034 <- calculate_city_index(dt_2019_34, dt_2020_34) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_201935_202035 <- calculate_city_index(dt_2019_35, dt_2020_35) %>% 
  filter(!(city_area_name %in% c("Bodø")))



# Spring specials
city_dt_spring <- calculate_city_index_movable_days(dt_2019_spring_specials,
                                                    dt_2020_spring_specials) %>% 
  filter(!(city_area_name %in% c("Bodø"))) %>% 
  mutate(ukedag = weekday)

# Easter
city_dt_palmweekend <- calculate_city_index(dt_2019_15_palmweekend,
                                            dt_2020_14_palmweekend) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_easterweek <- calculate_city_index(dt_2019_16_easterweek,
                                            dt_2020_15_easterweek) %>% 
  filter(!(city_area_name %in% c("Bodø")))

city_dt_eastermonday <- calculate_city_index(dt_2019_17_eastermonday,
                                            dt_2020_16_eastermonday) %>% 
  filter(!(city_area_name %in% c("Bodø")))


# Function for generating table ####
make_city_table <- function(city_dt, caption_text) {
  
  city_dt_table_ready <- city_dt %>%
    dplyr::ungroup() %>% 
    dplyr::select(-weekday, -no_trp) %>%
    dplyr::mutate(index = dplyr::na_if(index, "Inf")) %>% 
    tidyr::pivot_wider(names_from = ukedag,
                values_from = index)
  
  ncol_dt <- ncol(city_dt_table_ready)
  
  city_table <- city_dt_table_ready %>% 
    flextable() %>%
    set_header_labels(city_area_name = "Byområde") %>%
    bold(part = "header") %>%
    fontsize(size = 9, part = "all") %>%
    font(fontname = "Lucida Sans Unicode", part = "all") %>%
    bg(bg = "#ED9300", part = "header") %>%
    border_remove() %>%
    hline_top(part = "header", border = borderline) %>%
    hline_bottom(part = "all", border = borderline) %>%
    colformat_num(j = 2:ncol_dt, na_str = "", digits = 1) %>% 
    autofit() %>%
    height_all(height = .2) %>%
    padding(padding.top = .3,
            padding.bottom = .3) %>%
    set_caption(caption_text)
  
  return(city_table)
}

make_daily_plot <- function(area_dt, subtitle_text) {
  
  area_dt %>%
  ggplot2::ggplot(aes(ukedag, index)) +
  geom_bar(aes(fill = index > 0), stat = "identity",
           color = "#000000", 
           alpha = 0.6) +
  scale_fill_manual(guide = FALSE, breaks = c(FALSE, TRUE), 
                    values = c("#ed1c2e", "#58b02c")) +
  geom_hline(yintercept = 0, color = "#000000") +
  facet_grid(city_area_name ~., switch = "y") +
  scale_y_continuous(position = "right",
                     limits = c(-60, 20)) +
  xlab("") +
  ylab("Endring i trafikkmengde (%)\n") +
  ggtitle(label = "Daglig endring i trafikkmengde",
          subtitle = subtitle_text) +
  theme(strip.text.y = element_text(angle = 180),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank()) +
  labs(caption = "Data: Statens vegvesen")
}
```

# Bakgrunn

Som følge av smitteverntiltak i forbindelse med spredningen av det nye koronaviruset SARS-CoV-2, er det interessant å se hvordan trafikken endret seg. De første tiltakene ble annonsert av Regjeringen torsdag 12. mars 2020 (uke 11), og trådde i kraft fredag 13. mars.

Datagrunnlaget for beregningene hentes fra trafikkregistreringspunktene som inngår i byindeksene. Det vil gi et representativ utvalg for å kunne beregne trafikkutviklingen. Det gjøres en sammenligning av døgntrafikken, ukedag mot ukedag. Mandag sammenlignes med mandag osv.  

For å få et best mulig bilde av trafikkutviklingen gjøres to sammenligninger:

* Døgntrafikken sammenlignes med tilsvarende døgntrafikk i uke 10 i 2020, bortsett fra for Bodø og Tromsø som bruker uke 9 som sammenligning pga. vinterferie i uke 10.
* Døgntrafikken sammenlignes med tilsvarende døgntrafikk i samme uke i 2019

Alle data er hentet fra [trafikkdata.no](https://www.trafikkdata.no/). Døgntrafikk med minst 99 % dekningsgrad er brukt til å beregne prosentvis endring mellom to dager.

Vi tar forbehold om feil i datagrunnlaget. Enkelte trafikkregistreringspunkter er utelatt på grunn av feil på utstyr eller at de ligger på veier som er påvirket av vegarbeid o.l. Datagrunnlaget inkluderer likevel mange nok punkter til å få fram en generell trend i trafikkutviklingen.

Været vil enkelte dager kunne påvirke trafikkmengden. For eksempel vil det ved dårlig føre, som ved stort snøfall eller underkjølt regn, bli redusert framkommelighet og dette fører til mindre trafikk enn normalt.


# Endring i trafikk fra uka før smitteverntiltak i 2020

Påsken, som her er definert til å gjelde fra og med fredag før palmesøndag til og med Andre påskedag, er tatt ut og sammenlignet i egen figur og tabell.

Spesielle dager i mai og juni tas ut av den direkte sammenligningen uke for uke. Spesielle dager må sammenlignes direkte, og dette gjelder 1. mai, 17. mai, Kristi himmelfartsdag med påfølgende helg og Pinsen.

Med uke 20 avsluttes rekken med sammenligninger med uke 10, da sesongvariasjoner normalt gjør at det ikke forventes samme mengde trafikk.

## De største byområdene i Sør-Norge

### Fra uke 10 til 11, 2020

```{r plot_city_202011, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_11, "Fra uke 10 til uke 11 i 2020")
```

```{r table_city_202011}
make_city_table(city_dt_2020_10_11, 
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 11 i 2020.")
```

I tabellen over er endringen i trafikkmengden oppgitt i prosent, sammenlignet med uke 10 som utgangspunkt. Det vil si at trafikken har gått ned fra uke 10 til uke 11, når prosentverdien er negativ. Vi ser den samme tendensen i alle byområdene. Data baserer seg på trafikken registrert i følgende antall trafikkregistreringspunkt: Bergen 45, Nord-Jæren 43, Oslo og Akershus 76 og Trondheim 18.


### Fra uke 10 til 12, 2020

```{r plot_city_202012, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_12, "Fra uke 10 til uke 12 i 2020")
```



```{r table_city_202012}
make_city_table(city_dt_2020_10_12,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 12 i 2020.")
```


### Fra uke 10 til 13, 2020

```{r plot_city_202013, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_13, "Fra uke 10 til uke 13 i 2020")
```

```{r table_city_202013}
make_city_table(city_dt_2020_10_13,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 13 i 2020.")
```


### Fra uke 10 til 14, 2020

```{r plot_city_202014, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_14, "Fra uke 10 til uke 14 i 2020")
```

```{r table_city_202014}
make_city_table(city_dt_2020_10_14,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 14 i 2020.")
```


### Fra uke 10 til 16, 2020

```{r plot_city_202016, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_16, "Fra uke 10 til uke 16 i 2020")
```

```{r table_city_202016}
make_city_table(city_dt_2020_10_16,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 16 i 2020.")
```


### Fra uke 10 til 17, 2020

```{r plot_city_202017, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_17, "Fra uke 10 til uke 17 i 2020")
```

```{r table_city_202017}
make_city_table(city_dt_2020_10_17,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 17 i 2020.")
```


### Fra uke 10 til 18, 2020

```{r plot_city_202018, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_18, "Fra uke 10 til uke 18 i 2020")
```

```{r table_city_202018}
make_city_table(city_dt_2020_10_18,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 18 i 2020.")
```


### Fra uke 10 til 19, 2020

```{r plot_city_202019, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_19, "Fra uke 10 til uke 19 i 2020")
```


```{r table_city_202019}
make_city_table(city_dt_2020_10_19,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 19 i 2020.")
```


### Fra uke 10 til 20, 2020

```{r plot_city_202020, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2020_10_20, "Fra uke 10 til uke 20 i 2020")
```


```{r table_city_202020}
make_city_table(city_dt_2020_10_20,
                "Prosentvis endring i trafikkmengde fra uke 10 til uke 20 i 2020.")
```


## De største byområdene i Nord-Norge

### Fra uke 9 til 11, 2020

```{r plot_city_202011_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_11, "Fra uke 9 til uke 11 i 2020")
```

```{r table_city_202011_north}
make_city_table(city_dt_2020_09_11,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 11 i 2020.")
```

Tabellen over viser endringen i trafikkmengden oppgitt i prosent, sammenlignet med uke 9 som utgangspunkt. Data baserer seg på trafikken registrert i følgende antall trafikkregistreringspunkt: Bodø 11, Tromsø 14.


### Fra uke 9 til 12, 2020

```{r plot_city_202012_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_12, "Fra uke 9 til uke 12 i 2020")
```



```{r table_city_202012_north}
make_city_table(city_dt_2020_09_12,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 12 i 2020.")
```


### Fra uke 9 til 13, 2020

```{r plot_city_202013_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_13, "Fra uke 9 til uke 13 i 2020")
```



```{r table_city_202013_north}
make_city_table(city_dt_2020_09_13,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 13 i 2020.")
```

### Fra uke 9 til 14, 2020

```{r plot_city_202014_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_14, "Fra uke 9 til uke 14 i 2020")
```

```{r table_city_202014_north}
make_city_table(city_dt_2020_09_14,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 14 i 2020.")
```


### Fra uke 9 til 16, 2020

```{r plot_city_202016_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_16, "Fra uke 9 til uke 16 i 2020")
```

```{r table_city_202016_north}
make_city_table(city_dt_2020_09_16,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 16 i 2020.")
```


### Fra uke 9 til 17, 2020

```{r plot_city_202017_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_17, "Fra uke 9 til uke 17 i 2020")
```

```{r table_city_202017_north}
make_city_table(city_dt_2020_09_17,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 17 i 2020.")
```



### Fra uke 9 til 18, 2020

```{r plot_city_202018_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_18, "Fra uke 9 til uke 18 i 2020")
```

```{r table_city_202018_north}
make_city_table(city_dt_2020_09_18,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 18 i 2020.")
```


### Fra uke 9 til 19, 2020

```{r plot_city_202019_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_19, "Fra uke 9 til uke 19 i 2020")
```

```{r table_city_202019_north}
make_city_table(city_dt_2020_09_19,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 19 i 2020.")
```


### Fra uke 9 til 20, 2020

```{r plot_city_202020_north, fig.width=8, fig.height=6}
make_daily_plot(city_dt_2020_09_20, "Fra uke 9 til uke 20 i 2020")
```

```{r table_city_202020_north}
make_city_table(city_dt_2020_09_20,
                "Prosentvis endring i trafikkmengde fra uke 9 til uke 20 i 2020.")
```



# Endring i trafikk fra 2019 til 2020
Påsken, som her er definert til å gjelde fra og med fredag før palmesøndag til og med Andre påskedag, er tatt ut og sammenlignet i egen figur og tabell lenger ned. Siden påsken i 2019 var i uke 16, mens den i 2020 var i uke 15, blir det to uker som ikke kan sammenlignes direkte mellom årene.

Uke 21 i 2020 hadde Kristi himmelfartsdag, og er her sammenlignet med tilsvarende uke i 2019 som var uke 22. Den er angitt med "Uke 21/22".


```{r plot_city_201911, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201911_202011, "Fra uke 11 2019 til uke 11 i 2020")
```

```{r table_city_201911}
make_city_table(city_dt_201911_202011,
                "Prosentvis endring i trafikkmengde fra uke 11 2019 til uke 11 2020.")
```

I tabellen over er endringen i trafikkmengden oppgitt i prosent, sammenlignet med uke 11 i 2019 som utgangspunkt. Det vil si at trafikken har gått ned fra år 2019 til samme ukedag i 2020, når prosentverdien er negativ. Data baserer seg på trafikken registrert i følgende antall trafikkregistreringspunkt: Bergen 40, Nord-Jæren 44, Oslo og Akershus 65, Tromsø 11 og Trondheim 14. Bodø hadde litt for få punkter tilgjengelig med data i 2011 til at tall kan presenteres.

Vi ser den samme tendensen i alle byområdene, med unntak av onsdagen. [Onsdag 13. mars 2019 var det snøfall og underkjølt regn i Oslo og Akershus](https://www.yr.no/nb/historikk/graf/1-72837/Norge/Oslo/Oslo/Oslo?q=2019-03-13). Dette er nok forklaringen til at trafikken den dagen var mindre enn normalt, og at tilsvarende onsdag i 2020 hadde mer trafikk i sammenligningen.



```{r plot_city_201912, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201912_202012, "Fra uke 12 2019 til uke 12 i 2020")
```











```{r table_city_201912}
make_city_table(city_dt_201912_202012,
                "Prosentvis endring i trafikkmengde fra uke 12 2019 til uke 12 2020.")
```


```{r plot_city_201913, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201913_202013, "Fra uke 13 2019 til uke 13 i 2020")
```


```{r table_city_201913}
make_city_table(city_dt_201913_202013,
                "Prosentvis endring i trafikkmengde fra uke 13 2019 til uke 13 2020.")
```


```{r plot_city_201914, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201914_202014, "Fra uke 14 2019 til uke 14 i 2020")
```


```{r table_city_201914}
make_city_table(city_dt_201914_202014,
                "Prosentvis endring i trafikkmengde fra uke 14 2019 til uke 14 2020.")
```


```{r plot_city_201917, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201917_202017, "Fra uke 17 2019 til uke 17 i 2020")
```


```{r table_city_201917}
make_city_table(city_dt_201917_202017,
                "Prosentvis endring i trafikkmengde fra uke 17 2019 til uke 17 2020.")
```


```{r plot_city_201918, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201918_202018, "Fra uke 18 2019 til uke 18 i 2020")
```


```{r table_city_201918}
make_city_table(city_dt_201918_202018,
                "Prosentvis endring i trafikkmengde fra uke 18 2019 til uke 18 2020.")
```


```{r plot_city_201919, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201919_202019, "Fra uke 19 2019 til uke 19 i 2020")
```


```{r table_city_201919}
make_city_table(city_dt_201919_202019,
                "Prosentvis endring i trafikkmengde fra uke 19 2019 til uke 19 2020.")
```


```{r plot_city_201920, fig.width=8, fig.height=8}
make_daily_plot(city_dt_201920_202020, "Fra uke 20 2019 til uke 20 i 2020")
```

```{r table_city_201920}
make_city_table(city_dt_201920_202020,
                "Prosentvis endring i trafikkmengde fra uke 20 2019 til uke 20 2020.")
```


```{r plot_city_ascension, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2019_2020_ascension, 
                "Fra uke 22 2019 til uke 21 i 2020 (Kristi himmelfart)")
```

```{r table_city_ascension}
make_city_table(city_dt_2019_2020_ascension,
                "Prosentvis endring i trafikkmengde fra uke 22 2019 til uke 21 2020 (Kristi himmelfart).")
```


```{r plot_city_whitsun, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2019_2020_whitsun, 
                "Fra uke 23 2019 til uke 22 i 2020 (pinsehelg)")
```

```{r table_city_whitsun}
make_city_table(city_dt_2019_2020_whitsun,
                "Prosentvis endring i trafikkmengde fra uke 23 2019 til uke 22 2020 (pinsehelg).")
```

```{r plot_city_whitmonday, fig.width=8, fig.height=8}
make_daily_plot(city_dt_2019_2020_whitmonday, 
                "Fra uke 24 2019 til uke 23 i 2020 (mandag er 2. pinsedag)")
```


```{r table_city_whitmonday}
make_city_table(city_dt_2019_2020_whitmonday,
                "Prosentvis endring i trafikkmengde fra uke 24 2019 til uke 23 2020 (mandag er 2. pinsedag).")
```

```{r plot_city_201921, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201921_202024, 
#                "Fra uke 21 2019 til uke 24 i 2020")
```


```{r table_city_201921}
#make_city_table(city_dt_201921_202024,
#                "Prosentvis endring i trafikkmengde fra uke 21 2019 til uke 24 2020.")
```



```{r plot_city_201925, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201925_202025, 
#                "Fra uke 25 2019 til uke 25 i 2020")
```


```{r table_city_201925}
#make_city_table(city_dt_201925_202025,
#                "Prosentvis endring i trafikkmengde fra uke 25 2019 til uke 25 2020.")
```



```{r plot_city_201926, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201926_202026, 
#                "Fra uke 26 2019 til uke 26 i 2020")
```


```{r table_city_201926}
#make_city_table(city_dt_201926_202026,
#                "Prosentvis endring i trafikkmengde fra uke 26 2019 til uke 26 2020.")
```



```{r plot_city_201927, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201927_202027, 
#                "Fra uke 27 2019 til uke 27 i 2020")
```


```{r table_city_201927}
#make_city_table(city_dt_201927_202027,
#                "Prosentvis endring i trafikkmengde fra uke 27 2019 til uke 27 2020.")
```



```{r plot_city_201928, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201928_202028, 
#                "Fra uke 28 2019 til uke 28 i 2020")
```


```{r table_city_201928}
#make_city_table(city_dt_201928_202028,
#                "Prosentvis endring i trafikkmengde fra uke 28 2019 til uke 28 2020.")
```



```{r plot_city_201929, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201929_202029, 
#                "Fra uke 29 2019 til uke 29 i 2020")
```


```{r table_city_201929}
#make_city_table(city_dt_201929_202029,
#                "Prosentvis endring i trafikkmengde fra uke 29 2019 til uke 29 2020.")
```



```{r plot_city_201930, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201930_202030, 
#                "Fra uke 30 2019 til uke 30 i 2020")
```


```{r table_city_201930}
#make_city_table(city_dt_201930_202030,
#                "Prosentvis endring i trafikkmengde fra uke 30 2019 til uke 30 2020.")
```



```{r plot_city_201931, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201931_202031, 
#                "Fra uke 31 2019 til uke 31 i 2020")
```


```{r table_city_201931}
#make_city_table(city_dt_201931_202031,
#                "Prosentvis endring i trafikkmengde fra uke 31 2019 til uke 31 2020.")
```



```{r plot_city_201932, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201932_202032, 
#                "Fra uke 32 2019 til uke 32 i 2020")
```


```{r table_city_201932}
#make_city_table(city_dt_201932_202032,
#                "Prosentvis endring i trafikkmengde fra uke 32 2019 til uke 32 2020.")
```



```{r plot_city_201933, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201933_202033, 
#                "Fra uke 33 2019 til uke 33 i 2020")
```


```{r table_city_201933}
#make_city_table(city_dt_201933_202033,
#                "Prosentvis endring i trafikkmengde fra uke 33 2019 til uke 33 2020.")
```



```{r plot_city_201934, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201934_202034, 
#                "Fra uke 34 2019 til uke 34 i 2020")
```


```{r table_city_201934}
#make_city_table(city_dt_201934_202034,
#                "Prosentvis endring i trafikkmengde fra uke 34 2019 til uke 34 2020.")
```



```{r plot_city_201935, fig.width=8, fig.height=8}
#make_daily_plot(city_dt_201935_202035, 
#                "Fra uke 35 2019 til uke 35 i 2020")
```


```{r table_city_201935}
#make_city_table(city_dt_201935_202035,
#                "Prosentvis endring i trafikkmengde fra uke 35 2019 til uke 35 2020.")
```




## Sammenligning av spesielle dager i mai

```{r plot_city_spring, fig.width=8, fig.height=8}
make_daily_plot(city_dt_spring, "Fra 2019 til 2020")
```

```{r table_city_spring}
make_city_table(city_dt_spring,
                "Prosentvis endring i trafikkmengde fra 2019 til 2020.")
```

For 17. mai viser våre data ganske ulik endring i byene, men dette kan skyldes at våre trafikkregistreringspunkter i veldig ulik grad dekker veger som normalt er stengt 17. mai.


## Endring i påsketrafikken

```{r plot_city_palmweekend, fig.width=8, fig.height=8}
make_daily_plot(city_dt_palmweekend, "Fra palmehelga 2019 til palmehelga 2020")
```


```{r table_city_palmweekend}
make_city_table(city_dt_palmweekend,
                "Prosentvis endring i trafikkmengde fra palmehelga 2019 til palmehelga 2020.")
```



```{r plot_city_easterweek, fig.width=8, fig.height=8}
make_daily_plot(city_dt_easterweek, "Fra påskeuka 2019 til påskeuka 2020")
```


```{r table_city_easterweek}
make_city_table(city_dt_easterweek,
                "Prosentvis endring i trafikkmengde fra påskeuka 2019 til påskeuka 2020.")
```



```{r plot_city_eastermonday, fig.width=8, fig.height=8}
make_daily_plot(city_dt_eastermonday, "Fra 2. påskedag 2019 til 2. påskedag 2020")
```


```{r table_city_eastermonday}
make_city_table(city_dt_eastermonday,
                "Prosentvis endring i trafikkmengde fra 2. påskedag 2019 til 2. påskedag 2020.")
```



