---
title: "Ny byindeks for Oslo og Akershus"
output: html_notebook
---

```{r library, include = FALSE}
library(tidyverse)
#library(httr)
#library(jsonlite)
library(leaflet)
#library(htmlwidgets)
library(knitr)
#library(sf)
#library(mapview)
library(flextable)
#source("funksjoner_hent_nvdb_info.R")
```

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      error = FALSE, cache = TRUE)
```

```{r adt, include = FALSE}
# TODO: ÅDT (med dekingsgrad) 2018 fra TD-API.
# Leser inn ÅDT (må hentes fra NVDB-API eller trafikkdata-API på sikt)
# adt <- read.csv2("adt_2017_nortraf.csv") %>% 
#   filter(Felt == "R0") %>% 
#   mutate(Stasjonnr = as.character(Tellepunkt),
#          ADT = round(ADT, digits = -2)) %>% 
#  select(Stasjonnr, ADT)
```


```{r table, include=FALSE}
indekspunktene_oslo <- read.csv2("indekspunktene_oslo.csv")

indekspunktene_oslo %>% 
  dplyr::select(name, road_reference) %>% 
  dplyr::arrange(road_reference) %>% 
  flextable::flextable() %>% 
  flextable::set_header_labels(name = "Navn",
                               road_reference = "Vegreferanse") %>% 
  flextable::bold(part = "header") %>% 
  flextable::fontsize(size = 12, part = "all") %>% 
  flextable::font(fontname = "Lucida Sans Unicode", part = "all") %>% 
  flextable::bg(bg = "#ED9300", part = "header") %>% 
  flextable::align(part = "all") %>% 
  flextable::autofit() %>% 
  flextable::height_all(height = .2) %>% 
  flextable::padding(padding.top = .4,
                     padding.bottom = .4)
```

```{r mapcode, include=FALSE, cache=FALSE}
#pal <- colorFactor(c("navy", "red"), domain = c("TRS", "Bom"))

map.oslo <- indekspunktene_oslo %>% 
  leaflet(width = "100%") %>% 
  #addTiles() %>% 
  addProviderTiles(providers$Esri.WorldStreetMap) %>% 
  addCircles(lng = ~lon, lat = ~lat)
  #leaflet(width = "100%", 
  #        options = leafletOptions(minZoom = 0, maxZoom = 18)) %>% 
  #addProviderTiles(providers$Esri.WorldStreetMap) %>% 
  #addCircleMarkers(
  #  radius = 6,
  #  weight = 3,
  #  opacity = 0.6,
  #  fill = F
  #) #%>% 
  #addLabelOnlyMarkers(label = ~Veg,
  #                    labelOptions = 
  #                      labelOptions(noHide = T, 
  #                                   direction = 'top', 
  #                                   textOnly = T,
  #                                   offset = c(0, 7)))
```


```{r, echo=FALSE, cache=FALSE, message=TRUE}
#map.oslo
m <- leaflet() %>% setView(lng = 10.45, lat = 63.45, zoom = 7)
# TODO: Finne ut hvordan senter skal oppgis. Er det UTM33?
#m %>% addTiles()
#m %>% addProviderTiles(providers$Esri.WorldStreetMap)
m %>% addTiles(urlTemplate = "https://nvdbcache.geodataonline.no/arcgis/rest/services/Trafikkportalen/GeocacheTrafikkJPG/MapServer/tile/{z}/{y}/{x}",
               attribution = "NVDB, Geovekst, kommunene og Open Street Map contributors (utenfor Norge)")
```


